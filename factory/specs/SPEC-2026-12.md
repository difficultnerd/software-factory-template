---
spec_id: SPEC-2026-12
title: Simple Bookmark Manager API
status: draft
author: spec-agent
created: 2026-02-14
source_issue: "#12"
---

## Intent
I want an API to save, list, and delete bookmarks.
Each bookmark has a URL, title, and optional description.
I should be able to tag bookmarks and filter by tag.

## Summary
A REST API for personal bookmark management with CRUD operations, tagging system, and tag-based filtering. Single-user application with Supabase RLS for data isolation.

## Functional Requirements

### FR-001: Create bookmark
**Given** I am an authenticated user
**When** I POST to `/api/bookmarks` with valid bookmark data (URL, title, optional description, optional tags)
**Then** The system creates a bookmark record and returns the bookmark with generated ID and timestamps

### FR-002: List all bookmarks
**Given** I am an authenticated user
**When** I GET `/api/bookmarks`
**Then** The system returns all my bookmarks ordered by created_at descending with pagination support

### FR-003: Filter bookmarks by tag
**Given** I am an authenticated user with bookmarks that have tags
**When** I GET `/api/bookmarks?tag={tagname}`
**Then** The system returns only bookmarks that include the specified tag

### FR-004: Get single bookmark
**Given** I am an authenticated user who owns a bookmark
**When** I GET `/api/bookmarks/{id}`
**Then** The system returns the specific bookmark details

### FR-005: Update bookmark
**Given** I am an authenticated user who owns a bookmark
**When** I PUT to `/api/bookmarks/{id}` with updated bookmark data
**Then** The system updates the bookmark and returns the updated record

### FR-006: Delete bookmark
**Given** I am an authenticated user who owns a bookmark
**When** I DELETE `/api/bookmarks/{id}`
**Then** The system soft-deletes the bookmark and returns 204 status

### FR-007: List all user tags
**Given** I am an authenticated user with bookmarks that have tags
**When** I GET `/api/bookmarks/tags`
**Then** The system returns a unique list of all tags used in my bookmarks

## API Contracts

```yaml
paths:
  /api/bookmarks:
    post:
      summary: Create bookmark
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url, title]
              properties:
                url:
                  type: string
                  format: uri
                  maxLength: 2048
                title:
                  type: string
                  maxLength: 500
                description:
                  type: string
                  maxLength: 2000
                tags:
                  type: array
                  items:
                    type: string
                    maxLength: 50
                  maxItems: 20
      responses:
        201:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookmarkResponse'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/Unauthorized'
    get:
      summary: List bookmarks
      security:
        - bearerAuth: []
      parameters:
        - name: tag
          in: query
          schema:
            type: string
        - name: cursor
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookmarkListResponse'

  /api/bookmarks/{id}:
    get:
      summary: Get bookmark by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookmarkResponse'
        404:
          $ref: '#/components/responses/NotFound'
    put:
      summary: Update bookmark
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  format: uri
                  maxLength: 2048
                title:
                  type: string
                  maxLength: 500
                description:
                  type: string
                  maxLength: 2000
                tags:
                  type: array
                  items:
                    type: string
                    maxLength: 50
                  maxItems: 20
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookmarkResponse'
    delete:
      summary: Delete bookmark
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        204:
          description: Bookmark deleted successfully

  /api/bookmarks/tags:
    get:
      summary: List all user tags
      security:
        - bearerAuth: []
      responses:
        200:
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string

components:
  schemas:
    BookmarkResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/Bookmark'
    
    BookmarkListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Bookmark'
        meta:
          type: object
          properties:
            cursor:
              type: string
            hasMore:
              type: boolean
    
    Bookmark:
      type: object
      properties:
        id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
        title:
          type: string
        description:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
        user_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
          nullable: true
```

## Data Models

### Bookmark Entity
- `id` (uuid, primary key, not null)
- `user_id` (uuid, foreign key to auth.users, not null) - **RLS enforced**
- `url` (text, not null, max 2048 chars)
- `title` (text, not null, max 500 chars)
- `description` (text, nullable, max 2000 chars)
- `tags` (text[], nullable, array of strings max 50 chars each, max 20 items)
- `created_at` (timestamptz, not null, default now())
- `updated_at` (timestamptz, not null, default now(), updated on change)
- `deleted_at` (timestamptz, nullable) - soft delete

**Indexes:**
- Primary key on `id`
- Index on `user_id`
- Index on `created_at` (for ordering)
- GIN index on `tags` (for tag filtering)
- Partial index on `deleted_at IS NULL` (exclude soft-deleted)

**RLS Policies:**
- `SELECT`: `user_id = auth.uid() AND deleted_at IS NULL`
- `INSERT`: `user_id = auth.uid()`
- `UPDATE`: `user_id = auth.uid() AND deleted_at IS NULL`
- `DELETE`: `user_id = auth.uid()` (for soft delete updates)

**PII Fields:** None identified (URLs and titles may contain personal information but are not classified as PII under Privacy Act 1988)

## Security Requirements

### ASVS V3: Session Management
- **V3.2.1**: JWT verification via middleware before route handlers
- **Enforcement**: Authentication middleware validates Supabase JWT

### ASVS V4: Access Control  
- **V4.1.1**: Deny by default - all endpoints require authentication
- **V4.1.2**: Data isolation via RLS policies scoped to authenticated user
- **V4.2.1**: No IDOR - RLS prevents access to other users' bookmarks
- **Enforcement**: Supabase RLS policies + middleware auth check

### ASVS V5: Validation and Encoding
- **V5.1.1**: Input validation via Zod schemas at API boundary
- **V5.1.3**: URL validation with built-in format validation
- **V5.3.4**: Output encoding handled by framework JSON serialization
- **Enforcement**: Zod schemas + framework defaults

### ASVS V7: Error Handling and Logging
- **V7.4.1**: Structured logging for all bookmark operations (create, read, update, delete)
- **V7.4.3**: No sensitive data in logs (URLs logged as '[url]' placeholder)
- **Enforcement**: Structured logger + security review

### ASVS V13: API Security
- **V13.1.1**: RESTful API design with consistent authentication
- **V13.2.1**: Input validation on all API parameters
- **Enforcement**: Middleware + Zod validation

## Non-Functional Requirements

### Performance
- List bookmarks: <200ms response time within free tier constraints
- Cursor-based pagination to handle large bookmark collections efficiently
- GIN index on tags array for fast tag filtering

### Scalability Constraints (Free Tier)
- Cloudflare Workers 10ms CPU limit: Simple CRUD operations only, no complex processing
- Supabase free tier: 500MB database, suitable for thousands of bookmarks per user
- Maximum 20 tags per bookmark to prevent array size issues

### Data Retention
- Soft delete with 90-day retention before permanent deletion (via scheduled job)

## Infrastructure Requirements

None beyond current baseline. Uses existing Supabase database and Cloudflare Workers API infrastructure.

## Out of Scope

- Bookmark import/export functionality
- Bookmark sharing or collaboration features  
- Web scraping for automatic title/description extraction
- Full-text search within bookmark content
- Bookmark folders or hierarchical organization
- Multi-user functionality or team features
- Browser extension integration
- Bookmark deduplication
- URL validation beyond basic format checking

## Open Questions

None identified.

## Decision Log

| Timestamp | Agent | Tier | Decision | Reasoning |
|-----------|-------|------|----------|-----------|
| 2026-02-14T10:30:00Z | spec-agent | T1 | Use soft delete for bookmarks | Standard pattern for user-facing data recovery, aligns with PATTERNS.md |
| 2026-02-14T10:30:00Z | spec-agent | T1 | Store tags as text[] array in single table | Simpler than separate tags table for single-user case, supported by Postgres GIN indexes |
| 2026-02-14T10:30:00Z | spec-agent | T1 | Cursor-based pagination | More efficient than offset pagination, standard for REST APIs per PATTERNS.md |
| 2026-02-14T10:30:00Z | spec-agent | T1 | Single-user application with RLS | Default per PATTERNS.md, no multi-tenancy specified |
